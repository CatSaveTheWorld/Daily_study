# 상관분석

## 공분산

두 확률 변수의 선형관계를 나타내는 값이다. 분산이라는 개념을 확장하여 두 개의 확률 변수의 흩어진 정도를 공분산이라고 하는 것이다.

![img](./%EA%B3%B5%EB%B6%84%EC%82%B0.png)

### 공분산의 한계
공분산을 이용하면 두 개의 확률 변수의 상관정도를 구할 수 있지만, 공분산은 한계가 뚜렷하다. 바로 단위에 영향을 받는다는 점이다. 즉, 확률 변수가 큰 값을 다룬다면 공분산도 같이 커지고, 작은 값을 다룬다면 같이 작아진다.

예를 들어, 키(height)를 다룬다고 했을 때, 센티미터(cm)을 쓴다면 주로 100 ~ 200 사이의 값이 수집될 것이고, 밀리미터(mm)를 쓴다면 1000 ~ 2000 사이의 값이 수집될 것이다. 이를 타개하기 위해 고안된 것이 상관관계이다.

---

## 상관관계
사전적 의미는 어떤 한 통계적 변인과 다른 여러 통계적 변인들이 공변하는 함수관계를 말한다.

쉽게 말해서, 변인 x 가 갑자기 확 증가하자 변인 y 도 동시에 확 증가하고, 이후에 변인 x 가 감소하자 변인 y 도 동시에 감소한다면, x 와 y 사이에는 상관관계가 존재한다고 말할 수 있다. **[양의 상관관계]** 반대로, 변인 x 와 y 가 정반대 방향으로 움직인다 해도, 즉 x 가 증가하면 y 는 감소하고 x 가 감소하면 y 는 증가하는 방식이라도, 이것 역시 상관관계라고 말할 수 있게 된다.**[음의 상관관계]**

## 상관계수
상관관계에도 정도가 있다. 이것을 구체적인 수치로 나타낸 것이 상관계수이다.

여러가지 방법들이 있으며, 대표적으로 사용되는 계수는 `피어슨의 상관계수((Pearson Correlation Coefficient, Pearson's r)`가 있다.

그래프[산점도]로 나타내면 더 직관적으로 알 수 있는데, x축에 변인 x를, y축에 변인 y를 나타나게 한 뒤 각각의 관찰값들을 찍으면, 두 변인 간의 관계가 시각적으로 나타나게 된다.

여기서 그래프가 우상향할 경우 양(+)의 상관관계라 하고 상관계수가 1에 가까워지며, 우하향할 경우 음(-)의 상관관계라하고 상관계수가 -1에 가까워지려 한다. 또한, 그래프가 여기저기 흩어져있어 상관관계를 알 수 없는 경우 변인 x와 y는 독립으로 간주하고 이 때의 상관계수 또한 0에 가까워진다.

대강 정리하면 아래와 같다.

| 상관관계                  | 계수          | 그래프 모양                |
| ------------------------- | ------------- | -------------------------- |
| 양(+)의 상관관계 [정비례] | 1에 가까워짐  | 우상향                     |
| 독립적                    | 0에 가까워짐  | 패턴을 알 수 없음 (난잡함) |
| 음(-)의 상관관계 [반비례] | -1에 가까워짐 | 우하향                     |


### 피어슨의 상관계수
피어슨의 상관계수는 가장 널리 사용되는 상관계수이다. 측정하려는 두 변수의 상관관계가 서로 선형일 때 (1차 함수일 때) 사용이 가능하며, 만약 그래프가 직선이 아닌 곡선을 그린다면 다른 상관계수를 사용해야 한다.


**[피어슨의 상관계수 공식]**

![img](./%ED%94%BC%EC%96%B4%EC%8A%A8%EC%9D%98_%EC%83%81%EA%B4%80%EA%B3%84%EC%88%98.png)

여기서 
- n : 총 변량의 개수
- zX : 변수 X의 표준점수. 정확히는 표준점수 중에서 z-score를 뜻한다.

위 식은 중간에 변량을 모두 z점수로 변환하는 귀찮은 과정을 거쳐야 하기 때문에 학부에서는 좀더 간단한 아래와 같은 공식도 있다.

![img](./%ED%94%BC%EC%96%B4%EC%8A%A8%EC%9D%98_%EC%83%81%EA%B4%80%EA%B3%84%EC%88%98_1.png)

~~더 그지같아 보이는데 기분탓인가~~

이 상관계수 r은 그대로 사용되기 보다 한번 제곱한 상태로 사용하는 경우가 많다. 이를 `결정계수`(coefficient of determination, R2)라고 한다. 이 값이 상당히 중요한데, 측정하는 상관관계가 실제로 얼마나 큰지 보여주기 때문이다.

무슨 소리냐면 키와 유전자의 상관관계를 연구해서 결정계수가 0.6이 나온다면, 이걸 바로 적용해서 유전자의 측정된 차이가 키의 측정된 차이(변량)의 60%를 설명할 수 있다는 결론을 내릴 수 있다.
즉, 모델의 설명력을 뜻한다.

물론 설명하는 정도를 100% 신뢰하기는 어려운 것이, 잔차에 유의미한 정보가 남아있는 경우가 있기 때문이다.(즉, 회귀식이 완전하지 못할 경우.) 그래서 통계학에서 결정계수를 볼때는 반드시 회귀식의 타당성을 검토한다.

주의할 점이 상관계수는 단순히 상관관계만을 나타내므로 인과관계까지 추리할 수는 없다.

참고로 r을 약간 변형하면 t점수(t score)로 만들 수 있다. 그리고 이렇게 하면 r을 이용해서 가설검정을 할 수 있다. r을 t로 변환하는 식은 다음과 같다.

![img](./%EA%B2%B0%EC%A0%95%EA%B3%84%EC%88%98_tscore.png)

